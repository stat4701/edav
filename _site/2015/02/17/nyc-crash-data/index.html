
<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Daniel M Sheehan - Mini Assignment - IPython notebook and CartoDB Crash Data</title>
	<meta name="author" content="Michael Malecki">
	<link href='/assets/themes/the-minimum/css/style.css' rel="stylesheet" media="all">
	<link href="http://feeds.feedburner.com/" rel="alternate" title="Daniel M Sheehan - Mini Assignment - IPython notebook and CartoDB Crash Data" type="application/atom+xml">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
</head>
<body>

<div id="page" class="hentry">
	<header class="the-header">
		<div class="unit-head">
			<div class="unit-inner unit-head-inner">
				<p class="logo"><a href="/">EDAV</a></p>
				<nav class="nav-global">
					<ul>
						<li class="blog"><a href='archive.html'>blog &amp; slides</a></li>
						<li class="agenda"><a href='http://github.com/stat4701/edav/blob/gh-pages/agenda.md'>agenda</a></li>
						<li class="category"><a href='categories.html'>categories</a></li>
						<li class="tag"><a href='tags.html'>tags</a></li>
					</ul>
				</nav>
			</div><!-- unit-inner -->
		</div><!-- unit-head -->
	</header>
	<div class="body" role="main">
		<div class="unit-body">
			<div class="unit-inner unit-body-inner">
				<div class="entry-content">
					
<article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
						<h1 class="h2 entry-title">Daniel M Sheehan - Mini Assignment - IPython notebook and CartoDB Crash Data</h1>
					</div><!-- unit-inner -->
				</div><!-- unit-head -->
			</header>

			<div class="bd">
				<div class="entry-content">
					<p>I missed last Thursday&#39;s STAT W4701 class due to being under the weather but was able to check it out via Columbia Video Network. Dr. Malecki posted a <a href="http://stat4701.github.io/edav/2015/02/12/mini-assignment">mini assignment</a> where we could use NYC Crash Data. I&#39;ve used this data before for mapping pedestrian and bicycle injuries and fatalities. This data used to be available via <a href="http://crashstat.org/crashsolr/search">Transportation Alternatives: CrashStat</a> but is now delivered via <a href="https://data.cityofnewyork.us/NYC-BigApps/NYPD-Motor-Vehicle-Collisions/h9gi-nx95">NYC Open Data</a>.</p>

<h2>Some Python Pandas in IPython Notebook</h2>

<p>Converted to Markdown (of course). See my old blog post <a href="https://nygeog.github.io/2015/01/27/ipython-notebook-to-markdown%20copy.html">Using IPython Notebook with Pandas and exporting to Markdown</a>.</p>

<h4>Importing and cleaning the CSV</h4>
<div class="highlight"><pre><code class="language-text" data-lang="text">import pandas as pd

#csv_path = &#39;https://raw.githubusercontent.com/nygeog/data/master/nyc_crashes/data/NYPD_Motor_Vehicle_Collisions.csv&#39;
inCSV = &#39;data/NYPD_Motor_Vehicle_Collisions.csv&#39;
ouCSV = &#39;data/nypd_mv_collisions.csv&#39;

df = pd.read_csv(inCSV).rename(columns=lambda x: x.lower())

#drop ones w/out valid lat #super lazy, just grabbing lat&#39;s above 35
df = df[(df.latitude &gt; 35)]
#print df.dtypes 
print len(df.index)
df.head(5)

449644 #count of valid lat&#39;s records 
</code></pre></div>
<h4>The original CSV data (first 5 records)</h4>

<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>time</th>
      <th>borough</th>
      <th>zip code</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>location</th>
      <th>on street name</th>
      <th>cross street name</th>
      <th>off street name</th>
      <th>...</th>
      <th>contributing factor vehicle 2</th>
      <th>contributing factor vehicle 3</th>
      <th>contributing factor vehicle 4</th>
      <th>contributing factor vehicle 5</th>
      <th>unique key</th>
      <th>vehicle type code 1</th>
      <th>vehicle type code 2</th>
      <th>vehicle type code 3</th>
      <th>vehicle type code 4</th>
      <th>vehicle type code 5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td> 02/13/2015</td>
      <td> 21:45</td>
      <td>     MANHATTAN</td>
      <td> 10002</td>
      <td> 40.715622</td>
      <td>-73.994275</td>
      <td> (40.7156221, -73.9942752)</td>
      <td>     FORSYTH STREET</td>
      <td>   CANAL STREET</td>
      <td> NaN</td>
      <td>...</td>
      <td>             NaN</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> 3168577</td>
      <td> PASSENGER VEHICLE</td>
      <td>                       UNKNOWN</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td> 02/13/2015</td>
      <td> 21:45</td>
      <td>     MANHATTAN</td>
      <td> 10001</td>
      <td> 40.747535</td>
      <td>-73.988307</td>
      <td> (40.7475349, -73.9883068)</td>
      <td>     WEST 31 STREET</td>
      <td>       BROADWAY</td>
      <td> NaN</td>
      <td>...</td>
      <td> Fatigued/Drowsy</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> 3169163</td>
      <td>              TAXI</td>
      <td>                          TAXI</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td> 02/13/2015</td>
      <td> 21:45</td>
      <td>         BRONX</td>
      <td> 10462</td>
      <td> 40.833558</td>
      <td>-73.857732</td>
      <td> (40.8335582, -73.8577325)</td>
      <td> WESTCHESTER AVENUE</td>
      <td> PUGSLEY AVENUE</td>
      <td> NaN</td>
      <td>...</td>
      <td>     Unspecified</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> 3169251</td>
      <td> PASSENGER VEHICLE</td>
      <td> SPORT UTILITY / STATION WAGON</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td> 02/13/2015</td>
      <td> 21:44</td>
      <td>     MANHATTAN</td>
      <td> 10017</td>
      <td> 40.748800</td>
      <td>-73.969846</td>
      <td>  (40.7487997, -73.969846)</td>
      <td>     EAST 42 STREET</td>
      <td>       1 AVENUE</td>
      <td> NaN</td>
      <td>...</td>
      <td> Other Vehicular</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> 3169176</td>
      <td> PASSENGER VEHICLE</td>
      <td>             PASSENGER VEHICLE</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td> 02/13/2015</td>
      <td> 21:40</td>
      <td> STATEN ISLAND</td>
      <td> 10304</td>
      <td> 40.617295</td>
      <td>-74.080479</td>
      <td> (40.6172954, -74.0804791)</td>
      <td>   PARK HILL AVENUE</td>
      <td>  OSGOOD AVENUE</td>
      <td> NaN</td>
      <td>...</td>
      <td>     Unspecified</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> 3169614</td>
      <td> PASSENGER VEHICLE</td>
      <td>             PASSENGER VEHICLE</td>
      <td> NaN</td>
      <td> NaN</td>
      <td> NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 29 columns</p>
</div>

<h4>Mergin&#39; the date (day) and time (hours)</h4>
<div class="highlight"><pre><code class="language-text" data-lang="text">#create datetime http://stackoverflow.com/questions/17978092/combine-date-and-time-columns-using-python-pandas
df[&#39;datetime&#39;] = pd.to_datetime(df[&#39;date&#39;] + &#39; &#39; + df[&#39;time&#39;])


df = df[[&#39;datetime&#39;,&#39;latitude&#39;,&#39;longitude&#39;]]
df = df[(df.datetime &gt; &#39;2014-01-01 00:00:01&#39;)] #query out only data from 2014 onward
df = df.sort(&#39;datetime&#39;)
df.to_csv(ouCSV,index=False)
print len(df.index)

192324 #count of records 2014+

df.head(5)
</code></pre></div>
<h4>Clean and small data to import to CartoDB</h4>

<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>latitude</th>
      <th>longitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>228854</th>
      <td>2014-01-01 00:01:00</td>
      <td> 40.725432</td>
      <td>-73.996771</td>
    </tr>
    <tr>
      <th>228850</th>
      <td>2014-01-01 00:01:00</td>
      <td> 40.767889</td>
      <td>-73.981512</td>
    </tr>
    <tr>
      <th>228855</th>
      <td>2014-01-01 00:01:00</td>
      <td> 40.750844</td>
      <td>-73.978608</td>
    </tr>
    <tr>
      <th>229144</th>
      <td>2014-01-01 00:15:00</td>
      <td> 40.588646</td>
      <td>-73.992452</td>
    </tr>
    <tr>
      <th>228849</th>
      <td>2014-01-01 00:20:00</td>
      <td> 40.689019</td>
      <td>-73.986157</td>
    </tr>
  </tbody>
</table>
</div>

<hr>

<h4><a href="https://nygeog.cartodb.com/tables/nypd_mv_collisions_2014_20150213">The table on CartoDB&#39;s PostGIS Server</a></h4>

<h4>IPython Notebook to Markdown</h4>
<div class="highlight"><pre><code class="language-text" data-lang="text">IPython nbconvert 01-read-crash-data.ipynb --to markdown
</code></pre></div>
<hr>

<h2>Maps in CartoDB</h2>

<h4>PostGIS SQL Statement to grab 2014 from the 2014-2015/02/13 Table</h4>
<div class="highlight"><pre><code class="language-text" data-lang="text">SELECT * FROM nypd_mv_collisions_2014_20150213 WHERE datetime BETWEEN &#39;2014-01-01 00:00:00&#39; and &#39;2015-01-01 00:00:00&#39;
</code></pre></div>
<h4>Density Hex Bins of 2014 Collisions</h4>

<p>I&#39;m not totally sure if when creating the classes if it ignores hex bins with no collisions or what. Need to look into that. </p>

<iframe width='100%' height='520' frameborder='0' src='http://nygeog.cartodb.com/viz/7144d0b2-b6f2-11e4-bf9b-0e018d66dc29/embed_map' allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>

<h4>Density of 2014 Collisions over time (using Torque)</h4>

<p>Animation of Density of Collisions. I think these are Kernel Densities but not sure, need to check CartoDB documentation.</p>

<iframe width='100%' height='520' frameborder='0'
src='http://nygeog.cartodb.com/viz/8df5425a-b6ed-
11e4-9539-0e4fddd5de28/embed_map' allowfullscreen webkitallowfullscreen
mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>

<h4>Valentine&#39;s Day 2014 Collisions (Clickbait)</h4>

<p>I hate Clickbait. :)</p>

<iframe width='100%' height='520' frameborder='0' src='http://nygeog.cartodb.com/viz/8ebe3f92-b6f3-11e4-81dd-0e4fddd5de28/embed_map' allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>

<h4>Parting Note:</h4>

<p>While informative, crash data doesn&#39;t really tell us anything interesting about street design and whether specific places are more prone to crashes as without a denominator (such as traffic and/or pedestrian and/or cyclists) its difficult to discern if there&#39;s just more targets for collisions (like counting homicides vs. homicides per 10,000 people) or if street design (or in the case of homicides, higher homicide rate) is actually to blame. </p>

<p>New York City has some traffic estimates but nothing we can attribute to every street over the whole city. There may be something that NYC DOT or someone else has, but until its FOIL&#39;ed we can&#39;t really create that denominator without more reliable data. </p>

<h4>Code:</h4>

<ul>
<li><a href="https://raw.githubusercontent.com/nygeog/data/master/nyc_crashes/01-read-crash-data.ipynb">IPython Notebook</a></li>
<li><a href="https://github.com/nygeog/data/blob/master/nyc_crashes/01-read-crash-data.py">As a Python file</a></li>
</ul>

					<div class="meta">
						<p class="date-publish">
							Published: 
							<date class="date-pub" title="2015-02-17T00:00:00-05:00" datetime="2015-02-17T00:00:00-05:00" pubdate>
							<span class="month"><abbr>February</abbr></span>
							<span class="day">17</span>
							<span class="year">2015</span>
							</date>
						</p>
						<ul class="list-category list-linear">
							<li class="list-head">category: </li>
							
							


  
    
  


						</ul>
						<ul class="list-tag list-linear">
							<li class="list-head">tags: </li>
							
							


  
     
    	<li><a href="/tags.html#statw470-ref">statw470 <span>1</span></a></li>
     
    	<li><a href="/tags.html#nyc-ref">nyc <span>1</span></a></li>
     
    	<li><a href="/tags.html#collisions-ref">collisions <span>1</span></a></li>
     
    	<li><a href="/tags.html#ipython-ref">ipython <span>1</span></a></li>
     
    	<li><a href="/tags.html#cartodb-ref">cartodb <span>1</span></a></li>
    
  



						</ul>
					</div><!-- meta -->
				</div><!-- entry-content -->
				<div class="misc-content">
					<div class="social">
						<ul class="list-linear">
							<li><div class="twitter-tweet"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="mike_malecki" data-lang="en">Tweet</a></div></li>
							<li><div class="twitter-follow"><a href="https://twitter.com/mike_malecki" class="twitter-follow-button" data-show-count="false" data-lang="en"></a></div></li>
						</ul>
					</div>
					
					
				</div><!-- misc-content -->
				
			</div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							<li class="prev"><a class="internal" rel="prev"  href="/2015/02/17/jordan-collisions" title="View Jordan Collisions">&laquo; Jordan Collisions</a></li>
							
							
							<li class="pipe"> | </li>
							
							
							<li class="next"><a class="internal" rel="next"  href="/2015/02/17/project-planning" title="View Project Planning">Project Planning &raquo;</a></li>
							
						</ul>
					</nav>
					<p class="gotop">
						<a href="#page">Back to Top</a>
					</p>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>


				</div>
			</div><!-- unit-inner -->
		</div><!-- unit-body -->
	</div><!-- body -->
	<footer class="the-footer">
		<div class="unit-foot">
			<div class="unit-inner unit-foot-inner">
				<div class="misc vcard">
					<h4>about</h4>
					<ul>
						<li class="contact"><address><span class="author fn n">Michael Malecki</span> - <span class="fn email">malecki@gmail.com</span></address></li>
						<li class="github"><a href="http://github.com/malecki/" rel="me">github.com/malecki</a></li>
						<li class="twitter"><a href="http://twitter.com/mike_malecki/" rel="me">twitter.com/mike_malecki</a></li>
						<li class="rss"><a href="http://feeds.feedburner.com/">Subscribe to RSS Feed</a></li>
					</ul>
				</div><!-- misc -->
				<p class="licence">
					Theme: <a href="http://layouts-the.me">the_minimum</a> based on <a href="http://jekyllbootstrap.com/">Jekyll-bootstrap</a>.<br>
					Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a>.
				</p>
			</div><!-- unit-foot-inner -->
		</div><!-- unit-foot -->
	</footer>
</div><!-- page -->
<script>
	(function(d, s) {
		var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
		if (d.getElementById(id)) {return;}
		js = d.createElement(s); js.src = url; js.id = id;
		fjs.parentNode.insertBefore(js, fjs);
		};
	load('//platform.twitter.com/widgets.js', 'tweetjs');
	// load('https://apis.google.com/js/plusone.js', 'gplus1js'); // Checkout http://j.mp/ApDgMr for usage html for this is <div class="g-plusone" data-size="medium"></div>
	// load('//connect.facebook.net/en_US/all.js#xfbml=1', 'fbjssdk'); // Checkout http://j.mp/wZw2xR for using open graph protorol html for this is <div class="fb-like" data-href="/2015/02/17/nyc-crash-data" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false" data-font="verdana"></div>
	}(document, 'script'));
</script>
<script>
/*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
(function(j){var i=j.document;if(!i.querySelectorAll){return}var l=i.querySelectorAll("meta[name=viewport]")[0],a=l&&l.getAttribute("content"),h=a+", maximum-scale=1.0",d=a+", maximum-scale=10.0",g=true,c=j.orientation,k=0;if(!l){return}function f(){l.setAttribute("content",d);g=true}function b(){l.setAttribute("content",h);g=false}function e(m){c=Math.abs(j.orientation);k=Math.abs(m.gamma);if(k>8&&c===0){if(g){b()}}else{if(!g){f()}}}j.addEventListener("orientationchange",f,false);j.addEventListener("deviceorientation",e,false)})(this);
</script>

  
</body>
</html>

